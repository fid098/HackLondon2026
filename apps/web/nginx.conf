# Nginx config for serving the React SPA (production container)
#
# The key setting is `try_files $uri $uri/ /index.html` which ensures
# that React Router handles all client-side routes rather than nginx
# returning 404 for deep links.

server {
    listen 80;
    root /usr/share/nginx/html;
    index index.html;

    # All routes fall back to index.html — React Router takes over
    location / {
        try_files $uri $uri/ /index.html;
    }

    # Long-cache for hashed static assets (Vite appends content hashes)
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff2?)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # No cache for index.html — ensures users get the latest app version
    location = /index.html {
        add_header Cache-Control "no-store, no-cache, must-revalidate";
    }
}
